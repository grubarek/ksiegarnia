<ui:composition template="/WEB-INF/templates/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">

    <ui:define name="title">Użytkownicy</ui:define>

    <ui:define name="menu">
        <ui:include src="/modules/tab_menu.xhtml">
            <ui:param name="selectedTabIndex" value="0" />
        </ui:include>
    </ui:define>

    <ui:define name="content">
        <h:form id="listForm">
            <ui:include src="/modules/account_tab_menu.xhtml">
                <ui:param name="selectedTabIndex" value="0" />
            </ui:include>

            <p:dataTable var="account" id="table" value="#{accountBean.accounts}" widgetVar="accountsTable" emptyMessage="Nie ma jeszcze żadnego konta." paginator="true" rows="10" paginatorTemplate="{PreviousPageLink} {PageLinks} {NextPageLink}">
                <f:facet name="header">
                    <p:commandButton value="Nowe konto" icon="ui-icon-plus" action="#{accountBean.newAccount()}" update=":blockForm:growl" disabled="#{not request.isUserInRole('ADMIN')}" />
                    <p:outputPanel style="float: right;">
                        <h:outputText value="Szukaj:" />
                        <p:inputText id="globalFilter" onkeyup="accountsTable.filter()" style="width:150px; margin-left: 10px;" />
                    </p:outputPanel>
                    </f:facet>

                <p:column headerText="ID" filterMatchMode="contains" filterBy="#{account.id}" sortBy="#{account.id}" styleClass="wrap-text">#{account.id}</p:column>
                <p:column headerText="Login" filterMatchMode="contains" filterBy="#{account.login}" sortBy="#{account.login}" styleClass="wrap-text">#{account.login}</p:column>
                <p:column headerText="Aegon ID" filterMatchMode="contains" filterBy="#{account.aegonId}" sortBy="#{account.aegonId}" styleClass="wrap-text">#{account.aegonId}</p:column>
                <p:column headerText="Imię" filterMatchMode="contains" filterBy="#{account.firstName}" sortBy="#{account.firstName}" styleClass="wrap-text">#{account.firstName}</p:column>
                <p:column headerText="Nazwisko" filterMatchMode="contains" filterBy="#{account.lastName}" sortBy="#{account.lastName}" styleClass="wrap-text">#{account.lastName}</p:column>


                <p:column headerText="Data utworzenia" filterMatchMode="contains" filterBy="#{utilsBean.getDateString(account.creationDate)}"  sortBy="#{account.creationDate}">
                    <h:outputText value="#{account.creationDate}">
                        <f:convertDateTime pattern="dd.MM.yyyy HH:mm" />
                    </h:outputText>
                </p:column>
                <p:column headerText="Data aktualizacji" filterMatchMode="contains" filterBy="#{utilsBean.getDateString(account.updateDate)}" sortBy="#{account.updateDate}">
                    <h:outputText value="#{account.updateDate}">
                        <f:convertDateTime pattern="dd.MM.yyyy HH:mm" />
                    </h:outputText>
                </p:column>
                <p:column headerText="Status" filterMatchMode="contains" filterBy="#{accountBean.getStatusAsString(account.status)}" sortBy="#{account.status}">#{accountBean.getStatusAsString(account.status)}</p:column>

                <p:column headerText="Akcje" styleClass="action-column">
                    <p:commandButton id="selectButton" action="#{accountBean.edit()}" title="Edytuj" icon="ui-icon ui-icon-pencil" rendered="#{request.isUserInRole('AGENT PREMIUM') or request.isUserInRole('ADMIN')}">
                        <f:setPropertyActionListener value="#{account}" target="#{accountBean.selectedAccount}" />
                    </p:commandButton>

                    <p:commandButton id="viewButton" action="#{accountBean.details()}" title="Szczegóły" icon="ui-icon ui-icon-note">
                        <f:setPropertyActionListener value="#{account}" target="#{accountBean.selectedAccount}" />
                    </p:commandButton>

                    <p:commandButton id="meetingButton" action="#{accountBean.meetings()}" title="Spotkania" icon="ui-icon ui-icon-contact">
                        <f:setPropertyActionListener value="#{account}" target="#{accountBean.selectedAccount}" />
                    </p:commandButton>

                    <p:commandButton id="blockButton" action="#{accountBean.blockUnblock()}" title="Zablokuj" icon="#{utilsBean.getIconByStatus(account.status)}" disabled="#{not request.isUserInRole('AGENT PREMIUM') and not request.isUserInRole('ADMIN')}" rendered="#{utilsBean.isActive(account.status)}">
                        <f:setPropertyActionListener value="#{account}" target="#{accountBean.selectedAccount}" />
                    </p:commandButton>

                    <p:commandButton id="unblockButton" action="#{accountBean.blockUnblock()}" title="Odblokuj" icon="#{utilsBean.getIconByStatus(account.status)}" disabled="#{not request.isUserInRole('AGENT PREMIUM') and not request.isUserInRole('ADMIN')}" rendered="#{utilsBean.isBlocked(account.status)}">
                        <f:setPropertyActionListener value="#{account}" target="#{accountBean.selectedAccount}" />
                    </p:commandButton>

                    <p:commandButton id="deleteButton" oncomplete="removeConfirmation.show()" update=":listForm:confirmationDialog" title="Dezaktywuj" icon="ui-icon ui-icon-trash" disabled="#{not request.isUserInRole('ADMIN')}">
                        <f:setPropertyActionListener value="#{account}" target="#{accountBean.selectedAccount}" />
                    </p:commandButton>
                </p:column>
            </p:dataTable>

            <ui:include src="/modules/remove_item_dialog.xhtml">
                <ui:param name="message" value="Czy chcesz usunąć konto użytkownika '#{accountBean.selectedAccount.login}'?" />
                <ui:param name="header" value="Usuwanie konta" />
                <ui:param name="update" value=":listForm:table" />
                <ui:param name="bean" value="#{accountBean}" />
            </ui:include>
        </h:form>

        <h:outputText value="Ma uprawnienie tylko do poglądu swojego konta" rendered="#{ not request.isUserInRole('AGENT PREMIUM') and not request.isUserInRole('ADMIN') }" style="font-size: 16px; color: #c72a00;" />
        <h:outputText value="Ma uprawnienie do poglądu i edycji tylko swojego konta" rendered="#{request.isUserInRole('AGENT PREMIUM') and not request.isUserInRole('ADMIN')}" style="font-size: 16px; color: #c72a00;" />

    </ui:define>

</ui:composition>